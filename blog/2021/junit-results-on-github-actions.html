<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>JUnit Results on GitHub Actions Â« R4S11</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/prettify.css" rel="stylesheet">
    <link href="../../css/print.css" rel="stylesheet" media="print">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
            href="../../ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
            href="../../ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
            href="../../ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed"
            href="../../ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="alternate" type="application/rss+xml" title="RSS Feed for petefreitag.com" href="/feed.xml" />
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <header>
                      <a class="brand" href="../../index.html">
                        <h1>Rahul Somasunderam</h1>
                      </a>

                      <p>Programmer, Cyclist, Trivia Junkie.</p>

                      <h1>
                          <a href="http://github.com/rahulsom"><i class="icon-github" aria-hidden="true" alt="GitHub"></i></a>
                          <a href="http://twitter.com/rahulsom"><i class="icon-twitter" aria-hidden="true" alt="Twitter"></i></a>
                          <a href="http://linkedin.com/in/rahulsom"><i class="icon-linkedin" aria-hidden="true" alt="LinkedIn"></i></a>
                          <a href="http://stackoverflow.com/users/586134/rahul"><i class="icon-stack-overflow" aria-hidden="true" alt="Stack Overflow"></i></a>

                      </h1>
                      <br>
                      <p></p>

                      <ul class="pages">
                        <li><a href="../../about.html">About</a></li>
                        <li><a href="../../archive.html">Archive</a></li>
                        <li><a href="../../feed.xml">Subscribe</a></li>
                        <!-- <li><a href="/resume.html">Resume</a></li> -->
                      </ul>
                    </header>
                </div>
                <div class="col-md-9">
	
	
	<div class="page-header">
		<h1>JUnit Results on GitHub Actions</h1>
	</div>

	<p><em>16 August 2021</em></p>

	<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>GitHub Actions is a very accessible CI solution for OSS projects.
One shortcoming of most OSS-accessible CI systems is: accessing test results is difficult.
Compare just about any of those to Jenkins' JUnit results view.
With a little effort, you can get something close enough.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using_build_scans">Using Build Scans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I tend to use Gradle for most of my Java projects.
This guide uses Gradle.
It depends on a feature called <a href="https://docs.gradle.com/enterprise/gradle-plugin/">Gradle Build Scans</a>.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s enable Gradle Build scans on your build by adding this to your <code>settings.gradle.kts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">plugins {
  id "com.gradle.enterprise" version "3.6.3"
}

gradleEnterprise {
  buildScan {
    termsOfServiceUrl = "https://gradle.com/terms-of-service"
    termsOfServiceAgree = "yes"
    publishAlwaysIf(System.getenv("CI")) <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This will publish the build scan only for CI. You can replace it <code>publishAlways()</code> if you want to always publish build scans.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you now run a gradle build, your build will emit the build url to the console</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash"># ./gradlew build

...
...
BUILD SUCCESSFUL in 1m 0s
17 actionable tasks: 17 executed

Publishing build scan...
https://gradle.com/s/j67twx3r5jzqm <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the URL that contains a lot of information on the build, including the JUnit results.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Getting to these is a bit of a problem from a GitHub Pull Request.
So let&#8217;s extract this to a file first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.gradle.scan.plugin.PublishedBuildScan

gradleEnterprise {
  buildScan {
    // ... previous configuration
    buildScanPublished { PublishedBuildScan scan -&gt;
      file("build/gradle-scan.md").text = <i class="conum" data-value="1"></i><b>(1)</b>
          """Gradle Build Scan - [`${scan.buildScanId}`](${scan.buildScanUri})"""
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This will write some markdown to a file which we can then use as a comment on the pull request.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now when you run the same command, you&#8217;ll find a file in the <code>build</code> directory called <code>gradle-scan.md</code> that looks like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="markdown">Gradle Build Scan - [`mor6ne7ktkgwy`](https://gradle.com/s/mor6ne7ktkgwy)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s get GitHub Actions to process with it.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll assume that you have a file called <code>.github/workflows/build-pr.yml</code> that looks like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">name: Build PR

on:
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      # Other things

      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: 11
          distribution: zulu

      - name: Build with Gradle
        run: ./gradlew check build --stacktrace --parallel</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s add 3 more steps to it</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">      - id: get-comment-body <i class="conum" data-value="1"></i><b>(1)</b>
        if: always()
        run: |
          body=$(cat build/gradle-scan.md)
          body="${body//'%'/'%25'}"
          body="${body//$'\n'/'%0A'}"
          body="${body//$'\r'/'%0D'}"
          echo ::set-output name=body::$body

      - name: Find Comment
        uses: peter-evans/find-comment@v1
        if: always()
        id: fc <i class="conum" data-value="2"></i><b>(2)</b>
        with:
          issue-number: ${{ github.event.pull_request.number }}
          comment-author: 'github-actions[bot]'
          body-includes: Gradle Build Scan

      - name: Create or update comment <i class="conum" data-value="3"></i><b>(3)</b>
        uses: peter-evans/create-or-update-comment@v1
        if: always()
        with:
          comment-id: ${{ steps.fc.outputs.comment-id }}
          issue-number: ${{ github.event.pull_request.number }}
          body: ${{ steps.get-comment-body.outputs.body }}
          edit-mode: replace</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first step extracts reads the content of the file and converts it to something that can be sent as the body of an HTTP request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The second step finds if there is a previous comment we&#8217;ve made on the PR. If there is one, it captures the id of the comment so we can update it.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This step uses the comment and the comment id (if available), and then upserts a comment to the Pull Request.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using_github_checks">Using GitHub Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This approach uses GitHub checks to achieve the same effect.
The nice thing is: it annotates your Pull Request with the results of failed tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">      - name: Publish Test Report
        uses: mikepenz/action-junit-report@v2 <i class="conum" data-value="1"></i><b>(1)</b>
        if: always()
        with:
          report_paths: '**/build/test-results/test/TEST-*.xml'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="comparison">Comparison</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using GitHub checks is nice - it puts things right in your Pull Request.
However, it doesn&#8217;t give you access to all the information you expect to see from a JUnit report - STDOUT, STDERR and the stacktrace.</p>
</div>
<div class="paragraph">
<p>Gradle Build scans gives you access to that information.
You still have to navigate one site away to get that.</p>
</div>
<div class="paragraph">
<p>The good news is you can use both at the same time.</p>
</div>
</div>
</div></p>

	<hr />
	
      </div>
    </div>
    <footer>
      <p>&copy; Rahul Somasunderam 2012
      </p>
      <p><small>
        With help from <a href="http://jbake.org" target="_blank" title="JBake">JBake</a>. <br>
        Hosted on <a href="http://pages.github.com">GitHub Pages</a>. <br>
        Built at 2024-09-09 14:39:57 <br>
      </small></p>
    </footer>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../js/jquery-1.11.1.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/prettify.js"></script>

  </body>
</html>
